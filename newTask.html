<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="description" content="To Do App in vanilla Javascript, add task">
<meta name="keywords" content="HTML, CSS, JavaScript">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<head>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script>

		
		// function getJSONtasks() {
		// 	// returns a promise object

		// 	return fetch("/tasks.json")
		// 		.then(response => {
		// 			if (!response.ok) {
		// 				throw new Error("HTTP error " + response.status);
		// 			}
		// 			return response.json();
		// 		})
		// 		//.then(json => taskContainer = json) // not needed ?
		// 		.catch(error => {
		// 			/* Error handling */
		// 			console.log(error)
		// 		});

		// }


		/**
			 * @param task object
			 * This method saves json tasks in local storage
			 * 
			 * */
		async function tolocalStorageJSONtasks(task) {
			tasks = localStorage.getItem("tasks");
			// console.log(typeof(tasks)) // string 
			// JSON.parse(task).push(task);
			tasksj = JSON.parse(tasks);
			
			tasksj[tasksj.length]=task;
			localStorage.setItem(
				"tasks", JSON.stringify(tasksj)
			)
			
		}


		/**
		 * This method loads json tasks from local storage
		 * returns: Array with task objects inside
		 * */
		function fromlocalStorageJSONtasks() {
			let tasks = JSON.parse(localStorage.getItem("tasks"));
			return tasks;
		}



		function addTask() {


			// taskNumber = JSON.parse(localStorage["tasks"]).length; This would give an error, as when 
			//deleting element and adding a new one tasknumber would override the last task
			try{
				taskNumber = JSON.parse(localStorage["tasks"]).at(-1)["id"]; 
			}catch(TypeError){
				console.log("Type error");
				taskNumber = -1;
			}

			// TODO refactor error -> if empty, task number = 0


			
			title = document.getElementById("Task_title").value;
			init_date = document.getElementById("Task_init_date").value;
			end_date = document.getElementById("Task_end_date").value;
			tags = document.getElementById("Task_tags").value;
			description = document.getElementById("Task_description").value;

			new_task = {
				"id": taskNumber +1,
				"title": title,
				"init_date": init_date,
				"end_date": end_date,
				"description": description,
				"attachments": {}
			}

			tolocalStorageJSONtasks(new_task);

			event.currentTarget.submit();
			

		}



	</script>
</head>


<body>
	<main>
		<div class="app">
			<form action="index.html" name="newTaskForm" onsubmit="{event.preventDefault();addTask()}">
				<fieldset>
					<legend> Task info</legend>
					<label>Task name</label>
					<input id="Task_title" name="TaskTitle" type="text" placeholder="Task name">
					</input>

					<br>

					<label>Task initial date</label>
					<input id="Task_init_date" name="TaskInitDate" type="datetime-local" min="2022-01-07T00:00">
					<br>
					<!-- TODO check if min of end date is later than init -->
					<label>Task end date</label>
					<input id="Task_end_date" name="TaskEndDate" type="datetime-local" min="2018-06-07T00:00">
					<br>

					<label>Description</label>


					<!-- <input id="Description" name="Description" type="text" placeholder="Task description"> -->
					<textarea name="description" id="Task_description"></textarea>


					<br>
					<label>Tags</label>
					<input id="Task_tags" name="Tags" type="text" placeholder="Task tags">
					<br>

					<input type="submit" value="Add">
				</fieldset>
			</form>


		</div>
	</main>
</body>

</html>